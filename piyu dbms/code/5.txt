-- ✅ Enable Output
SET SERVEROUTPUT ON;

-- ✅ Drop old tables if exist (optional)
DROP TABLE Result;
DROP TABLE Stud_Marks;

-- ✅ Create Tables
CREATE TABLE Stud_Marks (
    Name VARCHAR2(50),
    Total_Marks NUMBER
);

CREATE TABLE Result (
    Roll NUMBER GENERATED BY DEFAULT AS IDENTITY,
    Name VARCHAR2(50),
    Class VARCHAR2(30)
);

-- ✅ Insert Sample Data
INSERT INTO Stud_Marks VALUES ('Amit', 1200);
INSERT INTO Stud_Marks VALUES ('Neha', 980);
INSERT INTO Stud_Marks VALUES ('Raj', 850);
INSERT INTO Stud_Marks VALUES ('Kiran', 800);
COMMIT;

-- ✅ Create Stored Procedure for Grade Categorization
CREATE OR REPLACE PROCEDURE proc_Grade(
    p_name IN VARCHAR2,
    p_marks IN NUMBER
)
IS
    v_class VARCHAR2(30);
BEGIN
    IF p_marks >= 990 AND p_marks <= 1500 THEN
        v_class := 'Distinction';
    ELSIF p_marks BETWEEN 900 AND 989 THEN
        v_class := 'First Class';
    ELSIF p_marks BETWEEN 825 AND 899 THEN
        v_class := 'Higher Second Class';
    ELSE
        v_class := 'Fail';
    END IF;

    INSERT INTO Result(Name, Class)
    VALUES(p_name, v_class);

    DBMS_OUTPUT.PUT_LINE('Student: ' || p_name || ' → Class: ' || v_class);

EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('⚠️ Error: ' || SQLERRM);
END;
/
-- ✅ Confirm creation
SHOW ERRORS;

-- ✅ Calling the Procedure using PL/SQL Block
BEGIN
    FOR rec IN (SELECT * FROM Stud_Marks) LOOP
        proc_Grade(rec.Name, rec.Total_Marks);
    END LOOP;
END;
/

-- ✅ Display Final Result Table
SELECT * FROM Result;
